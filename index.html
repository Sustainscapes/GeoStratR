<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simple Spatial Stratification of Rasters • GeoStratR</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Simple Spatial Stratification of Rasters">
<meta name="description" content="This software uses either the Calinski-Harabasz criterion or the simple structure index criterion to stratify a raster stack. It also generates different sampling designs for that stratification.">
<meta property="og:description" content="This software uses either the Calinski-Harabasz criterion or the simple structure index criterion to stratify a raster stack. It also generates different sampling designs for that stratification.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">GeoStratR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/how-to-use-GeoStratR.html">How to use the GeoStratR package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="geostratr">GeoStratR<a class="anchor" aria-label="anchor" href="#geostratr"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of GeoStratR from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"GeoStratR"</span><span class="op">)</span></span></code></pre></div>
<p>And the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Sustainscapes/GeoStratR"</span><span class="op">)</span></span></code></pre></div>
<p>The goal of this package is to Stratify spatial areas based on raster and then generate stratified random sampling schemes for such strata, as an example we will show how to generate a stratified sampling scheme for Denmark based on for bioclimatic variables, for this we will use the internall dataset bios, as can be seen in the next figure:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sustainscapes.github.io/GeoStratR/">GeoStratR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.78</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Bios"</span><span class="op">)</span></span>
<span><span class="va">Bios</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">Bios</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Bios</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-BiosPlot-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="optimal-strata">Optimal strata<a class="anchor" aria-label="anchor" href="#optimal-strata"></a>
</h2>
<p>To stratify we can use the function <code>Stratify</code>, which automatically determines the optimal number of classes by evaluating a range of possible groupings. This function performs k-means clustering on the raster stack, testing from a minimum to a maximum number of groups specified by the user. It then selects the best number of groups based on a chosen criterion.</p>
<p>The Stratify function allows you to choose between two criteria for selecting the optimal number of classes:</p>
<ul>
<li><p><strong>Calinski-Harabasz Index</strong> (“calinski”): This criterion measures the variance between clusters relative to the variance within clusters. A higher Calinski-Harabasz index indicates a better-defined and more distinct clustering structure, making it suitable for identifying well-separated groups.</p></li>
<li><p><strong>simple structure index</strong> (“ssi”): This criterion assesses how similar an object is to its own cluster compared to other clusters. A higher silhouette width indicates that the clustering is more cohesive and that objects are more appropriately assigned to their respective clusters.</p></li>
</ul>
<p>By leveraging these criteria, the Stratify function ensures that the chosen number of groups provides the best balance between within-cluster homogeneity and between-cluster separation. The output includes a raster layer where each pixel is assigned to the optimal class, as well as a dataframe summarizing the performance of each tested grouping. This enables users to visualize and analyze the stratified areas effectively.</p>
<p>Here’s how you can use the Stratify function with the Bios dataset to determine the optimal number of classes and visualize the results:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Stratify.html">Stratify</a></span><span class="op">(</span><span class="va">Bios</span>, LowGroup <span class="op">=</span> <span class="fl">2</span>, HighGroup <span class="op">=</span> <span class="fl">10</span>, Criterion <span class="op">=</span> <span class="st">"calinski"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="view-the-results">View the results<a class="anchor" aria-label="anchor" href="#view-the-results"></a>
</h1>
<p>From there we can see the</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span><span class="op">$</span><span class="va">Results</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">SSE</th>
<th align="right">calinski</th>
<th align="right">n_groups</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1835439.6</td>
<td align="right">18088.99</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">2413170.4</td>
<td align="right">18064.95</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">1263139.5</td>
<td align="right">17782.43</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">1087909.5</td>
<td align="right">17774.15</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">962866.6</td>
<td align="right">17624.99</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">1536113.7</td>
<td align="right">17425.12</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">880202.3</td>
<td align="right">17170.34</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="right">4499626.3</td>
<td align="right">13709.32</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">9258256.1</td>
<td align="right">11495.11</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>Calinski ctiterion vs number of partitions</p>
</div>
<div class="section level1">
<h1 id="plot-the-final-raster-stack-with-the-optimal-classes">Plot the final raster stack with the optimal classes<a class="anchor" aria-label="anchor" href="#plot-the-final-raster-stack-with-the-optimal-classes"></a>
</h1>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">FinalStack</span>, colNA <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-CalinskiPlot-1.png" width="100%"></p>
<p>In this example, the Stratify function will test different numbers of classes from 2 to 10, using the Calinski-Harabasz index to determine the best grouping. The resulting raster will display the optimal stratification, and the results dataframe will provide details on how each number of groups performed according to the selected criterion.</p>
<p>This approach allows for a robust and data-driven method of stratifying spatial data, ensuring that the generated classes are both meaningful and effective for subsequent analyses.</p>
<div class="section level2">
<h2 id="stratified-sampling">Stratified sampling<a class="anchor" aria-label="anchor" href="#stratified-sampling"></a>
</h2>
<p>After determining the optimal strata, you can use the function Random_Stratified_Min_Dist to generate a random stratified sampling scheme. This function ensures that the sample points are distributed with a minimum distance both from other points within the same stratum and from the stratum borders. If you do not specify a minimum distance to the border, the same distance used for spacing between points will be applied to the border as well.</p>
<p>Here’s an example of how to use this function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Points</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Random_Stratified_Min_Dist.html">Random_Stratified_Min_Dist</a></span><span class="op">(</span>ClassRaster <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">FinalStack</span>,</span>
<span>                                     MinDist <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                                     BorderDist <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>                                     n <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                                     n_to_test <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(x, y)`</span></span></code></pre></div>
<p>The resulting plot shows the stratified sampling points overlaid on the optimal strata:</p>
<p><img src="reference/figures/README-plotSampl-1.png" width="100%"></p>
<p>This approach ensures a very balanced sampling:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Points</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A  B  C  D  E </span></span>
<span><span class="co">#&gt; 30 30 30 30 30</span></span></code></pre></div>
<p>The Random_Stratified_Min_Dist function is robust and can handle cases where some classes cannot achieve the desired number of points. For example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Points2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Random_Stratified_Min_Dist.html">Random_Stratified_Min_Dist</a></span><span class="op">(</span>ClassRaster <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">FinalStack</span>,</span>
<span>                                     MinDist <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                                     BorderDist <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                                     n <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                                     n_to_test <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(x, y)`</span></span></code></pre></div>
<p>Even if some classes cannot meet the target of 500 points, the function still works effectively:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Points2</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   A   B   C   D   E </span></span>
<span><span class="co">#&gt; 500 462 335 500 500</span></span></code></pre></div>
<p>This flexibility ensures that your sampling scheme is both effective and adaptable to varying conditions within your study area. By maintaining minimum distances, the function helps prevent clustering of sample points and ensures a more representative and unbiased sampling distribution across the strata.</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing GeoStratR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Derek Corcoran <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0248-6230" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/Sustainscapes/GeoStratR/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/Sustainscapes/GeoStratR/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Derek Corcoran.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
